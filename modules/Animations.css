/*Window Control styling*/
@media not (-moz-bool-pref: "zen.view.experimental-no-window-controls") {
    .titlebar-button {
        min-height: 13px !important;
        min-width: 13px !important;
        padding: 0px !important;
        height: 13px !important;
        width: 13px !important;

        align-self: center;

        border-radius: 50px;
        margin: auto 3px !important;
        background-color: rgba(200, 200, 200, 0.3) !important;
        transition: all 200ms ease-in-out;
    }

    .titlebar-button>image {
        visibility: hidden !important;
    }

    .titlebar-buttonbox {
        align-content: center !important;
        justify-content: center !important;
        margin-right: calc(var(--zen-element-separation) / 2) !important;
    }

    .titlebar-buttonbox-container {
        align-self: center !important;
        justify-self: center !important;
        justify-content: center !important;
        align-content: center !important;
        margin-top: auto !important;
        margin-bottom: auto !important;
        padding-bottom: auto !important;
    }

    .titlebar-button:hover {
        min-height: 20px !important;

        &.titlebar-min:hover {
            background-color: color-mix(in srgb, var(--zen-primary-color) 90%, white) !important;
            box-shadow: 0 0px 8px color-mix(in srgb, var(--zen-primary-color) 90%, white) !important;
        }

        &.titlebar-restore:hover {
            background-color: color-mix(in srgb, var(--zen-primary-color) 60%, white) !important;
            box-shadow: 0 0px 8px color-mix(in srgb, var(--zen-primary-color) 60%, white) !important;
        }

        &.titlebar-max:hover {
            background-color: color-mix(in srgb, var(--zen-primary-color) 60%, white) !important;
            box-shadow: 0 0px 8px color-mix(in srgb, var(--zen-primary-color) 60%, white) !important;
        }

        &.titlebar-close:hover {
            background-color: color-mix(in srgb, var(--zen-primary-color) 20%, rgb(255, 90, 100)) !important;
            box-shadow: 0 0px 8px color-mix(in srgb, var(--zen-primary-color) 20%, rgb(255, 90, 100)) !important;
        }
    }
}

@media not (-moz-bool-pref: "zen.view.experimental-no-window-controls") {
    @media (-moz-bool-pref: "zen.view.experimental-force-window-controls-left") {
        .titlebar-buttonbox-container {
            order: -1 !important;
        }

        @media (-moz-bool-pref: "neo-theme-window-buttons-inverse") {
            :root[zen-single-toolbar="true"] {
                .titlebar-buttonbox-container {
                    order: 9999 !important;
                }
            }
        }
    }

    @media not (-moz-bool-pref: "zen.view.experimental-force-window-controls-left") {
        @media not (-moz-bool-pref: "neo-theme-window-buttons-inverse") {
            :root[zen-single-toolbar="true"] {
                .titlebar-buttonbox-container {
                    order: -1 !important;
                }
            }
        }
    }

    @media -moz-pref("zen.tabs.vertical") {
        :root:not([zen-single-toolbar="true"]):not([zen-right-side="true"])[zen-window-buttons-reversed="true"]:not([zen-sidebar-expanded="true"]):not([zen-compact-mode="true"]) {
            .titlebar-buttonbox {
                left: calc(var(--zen-toolbox-padding) * -1 / 2 - 1.5px) !important;
            }
        }

        :root:not([zen-single-toolbar="true"])[zen-right-side="true"]:not([zen-window-buttons-reversed="true"]):not([zen-sidebar-expanded="true"]):not([zen-compact-mode="true"]) {
            .titlebar-buttonbox {
                margin-right: calc(var(--zen-element-separation) / 2 - 1px) !important;
            }
        }

       
      @media -moz-pref("zen.tabs.vertical") {
        :root:not([zen-single-toolbar="true"]):not([zen-right-side="true"])[zen-window-buttons-reversed="true"]:not([zen-sidebar-expanded="true"]):not([zen-compact-mode="true"]) {
          .titlebar-buttonbox {
            left: auto !important;
            right: 18px !important;
          }
        }


/* Adds default selected tab background color to Pinned tabs */
.tabbrowser-tab[pinned]:not([selected="true"]):not([zen-essential="true"]) .tab-stack .tab-background,
#vertical-pinned-tabs-container:not([selected="true"]) > .zen-workspace-tabs-section tab-group,
.zen-workspace-pinned-tabs-section:not([selected="true"]) tab-group {
    background-color: var(--zen-colors-secondary) !important; 
}

/* Adds border to Pins only */
.tabbrowser-tab[pinned][selected="true"]:not([zen-essential="true"]) .tab-stack .tab-background,
#vertical-pinned-tabs-container[selected="true"] > .zen-workspace-tabs-section tab-group,
.zen-workspace-pinned-tabs-section[selected="true"] tab-group {
    border: 1px solid light-dark(
        color-mix(in srgb, var(--zen-colors-secondary) 80%, black),
        color-mix(in srgb, var(--zen-colors-secondary) 80%, white)
    ) !important;
}
  
/* Hardware acceleration & will-change for best performance */
#tabbrowser-tabs,
.tabbrowser-tab,
#nav-bar toolbarbutton,
#PersonalToolbar toolbarbutton,
#urlbar,
#searchbar,
menupopup,
panel,
tooltip {
  transform: translateZ(0);
  will-change: auto;
}

/* === TAB ANIMATIONS === */
/* Tab hover and active animation with enhanced shadows */
.tabbrowser-tab[pinned]:not([zen-essential="true"]) {       
padding-top: 2px !important;  
}

.tabbrowser-tab {
  transition: box-shadow 0.2s cubic-bezier(0.4,0,0.2,1), 
              transform 0.24s cubic-bezier(0.22,1.5,0.36,1),
              opacity 0.15s cubic-bezier(0.4,0,0.2,1),
              filter 0.2s ease !important;
  box-shadow: none !important;
}

.tabbrowser-tab:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 4px 12px -4px rgba(30,40,80,0.09);
  z-index: 2;
}

/* Fade inactive tabs with breathing effect */
.tabbrowser-tab:not([selected]) {
  opacity: 0.82;
  filter: blur(0.2px);
  animation: tabBreathe 4s ease-in-out infinite;
}

@keyframes tabBreathe {
  0%, 100% { opacity: 0.82; }
  50% { opacity: 0.75; }
}

/* Enhanced tab opening animation */
.tabbrowser-tab[fadein] {
  animation: tabBounceIn 0.34s cubic-bezier(0.68,-0.6, 0.32,1.6);
}

@keyframes tabBounceIn {
  0% { opacity: 0; transform: scale(0.86) translateY(4px) rotateX(15deg); }
  60% { opacity: 1; transform: scale(1.09) translateY(-3px) rotateX(-5deg); }
  100% { opacity: 1; transform: scale(1.0) translateY(0) rotateX(0); }
}

/* Enhanced tab closing animation */
.tabbrowser-tab[closing] {
  animation: tabShrinkOut 0.19s cubic-bezier(0.68,-0.6, 0.32,1.6) forwards;
}

@keyframes tabShrinkOut {
  0% { opacity: 1; transform: scale(1.0) rotateY(0deg); max-width: 100%; }
  50% { opacity: 0.3; transform: scale(0.9) rotateY(15deg); }
  100% { opacity: 0; transform: scale(0.7) rotateY(30deg); max-width: 0; }
}

/* Pinned tab special pulse animation */
.tabbrowser-tab[pinned="true"] {
  animation: pinnedPulse 3s ease-in-out infinite;
}

@keyframes pinnedPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(68, 138, 255, 0.4); }
  50% { box-shadow: 0 0 0 4px rgba(68, 138, 255, 0.1); }
}

/* show tab close/reset button only on hover with cool animation */
:is(.tab-close-button, .tab-reset-button)
{transition: all .3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;}

.tabbrowser-tab:not([pinned],[zen-essential])
.tab-close-button,
.tabbrowser-tab[pinned]:not([zen-essential])
.tab-reset-button
{display: flex !important;}

.tabbrowser-tab:not([pinned]):not(:hover) 
:is(.tab-close-button, .tab-reset-button){
  margin-inline-end: -25px !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* NAVIGATION BUTTON ANIMATIONS */
#back-button {
  transition: transform 0.22s cubic-bezier(0.68,-0.6, 0.32,1.6),
              box-shadow 0.18s cubic-bezier(0.4,0,0.2,1),
              opacity 0.15s ease !important;
  border-radius: 6px;
}

#back-button:hover {
  transform: translateX(-2px) translateY(-1px) scale(1.08);
  box-shadow: 0 4px 12px -3px rgba(30,40,80,0.15);
}

#back-button:active {
  transform: translateX(-1px) scale(1.05);
  transition-duration: 0.1s;
}

/* Forward button without trail effect */
#forward-button {
  transition: transform 0.22s cubic-bezier(0.68,-0.6, 0.32,1.6),
              box-shadow 0.18s cubic-bezier(0.4,0,0.2,1),
              opacity 0.15s ease !important;
  border-radius: 6px;
}

#forward-button:hover {
  transform: translateX(2px) translateY(-1px) scale(1.08);
  box-shadow: 0 4px 12px -3px rgba(30,40,80,0.15);
}

#forward-button:active {
  transform: translateX(1px) scale(1.05);
  transition-duration: 0.1s;
}

/* Reload button with enhanced spin and pulse */
#reload-button {
  transition: transform 0.25s cubic-bezier(0.68,-0.6, 0.32,1.6),
              box-shadow 0.18s cubic-bezier(0.4,0,0.2,1),
              opacity 0.15s ease !important;
  border-radius: 6px;
  position: relative;
}

#reload-button:hover {
  transform: translateY(-2px) scale(1.1) rotate(15deg);
  box-shadow: 0 5px 14px -4px rgba(30,40,80,0.18);
  animation: reloadPulse 1s ease-in-out infinite;
}

@keyframes reloadPulse {
  0%, 100% { box-shadow: 0 5px 14px -4px rgba(30,40,80,0.18); }
  50% { box-shadow: 0 5px 14px -4px rgba(68,138,255,0.25); }
}

#reload-button[loading="true"] {
  animation: reloadSpin 1s linear infinite;
}

@keyframes reloadSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Menu button animation */
@keyframes menuButtonAnimation {
  0%   { transform: rotate(0deg) scale(1); }
  30%  { transform: rotate(12deg) scale(1.05); }
  50%  { transform: rotate(-12deg) scale(1.08); }
  70%  { transform: rotate(6deg) scale(1.12); }
  85%  { transform: rotate(-4deg) scale(1.18); }
  95%  { transform: rotate(2deg) scale(1.22); }
  100% { transform: rotate(0deg) scale(1.2); }
}

#PanelUI-menu-button:hover {
  animation: menuButtonAnimation 0.6s cubic-bezier(.2,.49,.78,1.01) forwards;
}

/* === CONTEXT MENU ENHANCEMENTS === */
menuitem {
  transition: all 0.25s ease-in-out !important;
}

[hasbeenopened="true"] {
  toolbarbutton,subviewbutton{
    toolbarbutton-text {
      padding: 0px 0px !important;
      opacity: 1 !important;
      transition: all 0.25s ease-in-out !important;
    }
  }
}

[hasbeenopened="true"] {
  menuitem,
  menu,.subviewbutton{
    .menu-text {
      padding: 1.5px 5px !important;
      opacity: 1 !important;
      transition: all 0.25s ease-in-out !important;
    }

     &:hover > .menu-text, &:hover > .toolbarbutton-text {
      padding-left: 9px !important;
      padding-right: 1px !important;
    }
  }
}


/* Enhanced context menu with stagger animation */
menupopup {
  animation: contextMenuSlideIn 0.18s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important;
  transform-origin: top left;
}

@keyframes contextMenuSlideIn {
  0% {
    opacity: 0;
    transform: scale(0.92) translateY(-4px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* Context menu items with stagger delay */
menuitem {
  transition: background-color 0.12s ease,
              transform 0.15s cubic-bezier(0.4, 0, 0.2, 1),
              opacity 0.12s ease !important;
  animation: menuItemSlideIn 0.2s ease-out backwards;
}

menuitem:nth-child(1) { animation-delay: 0.02s; }
menuitem:nth-child(2) { animation-delay: 0.04s; }
menuitem:nth-child(3) { animation-delay: 0.06s; }
menuitem:nth-child(4) { animation-delay: 0.08s; }
menuitem:nth-child(5) { animation-delay: 0.10s; }
menuitem:nth-child(n+6) { animation-delay: 0.12s; }

@keyframes menuItemSlideIn {
  0% {
    opacity: 0;
    transform: translateX(-10px);
  }
  100% {
    opacity: 1;
    transform: translateX(0);
  }
}

/* === NOTIFICATION ANIMATIONS === */
/* Download notification */
#downloads-notification-anchor {
  transition: transform 0.3s cubic-bezier(0.68,-0.6, 0.32,1.6);
}

#downloads-notification-anchor[notification] {
  animation: downloadBounce 0.6s cubic-bezier(0.68,-0.6, 0.32,1.6);
}
@keyframes downloadBounce {
  0% { transform: scale(1); }
  30% { transform: scale(1.2) rotate(-5deg); }
  60% { transform: scale(0.9) rotate(3deg); }
  100% { transform: scale(1) rotate(0deg); }
}

#sidebar-box[hidden="true"] {
  transform: translateX(-100%);
  opacity: 0;
}

/* === PERFORMANCE OPTIMIZATIONS === */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Hardware acceleration for all animated elements */
.tabbrowser-tab *, 
#nav-bar toolbarbutton *,
#PersonalToolbar toolbarbutton *,
#urlbar *, #searchbar *,
menupopup *, menuitem *,
#sidebar-box *, #downloads-notification-anchor * { 
  backface-visibility: hidden; 
}

/* ACCESSIBILITY & FUNCTIONALITY PRESERVATION */
.tabbrowser-tab[dragged],
.tabbrowser-tab[moving] {
  transition: none !important;
  animation: none !important;
}

/* Focus indicators for keyboard navigation */
#nav-bar toolbarbutton:focus-visible,
.tabbrowser-tab:focus-visible {
  outline: 2px solid #448aff;
  outline-offset: 2px;
  animation: focusPulse 1s ease-in-out infinite;
}
@keyframes focusPulse {
  0%, 100% { outline-color: #448aff; }
  50% { outline-color: #64b5f6; }
}

  

/* ------------------------- QUIETIFY SOUND ICON ------------------------- 
   .tab-audio-button {
    display: none !important;
    }

    .zen-essentials-container .tab-icon-overlay {
      pointer-events: none !important;
    }
  
    .tabbrowser-tab img {
      transition: opacity 0.3s ease-in-out;
    }
  
    .tabbrowser-tab:is([soundplaying], [muted], [activemedia-blocked]) img {
      opacity: 0 !important;
      transition: opacity 0.1s !important;
    }
  
    .tab-icon-overlay {
      &:is([soundplaying], [muted], [activemedia-blocked]) {
        display: block !important;
        border: 0px !important;
        border-radius: 0px !important;
        top: 0px !important;
        right: 0px !important;
        scale: 1.3 !important;
        opacity: 0.9 !important;
        margin: 0px 3px !important;
        background: none !important;
        --play-svg: url("data:image/svg+xml,%3Csvg width='14' height='14' viewBox='0 0 135 140' xmlns='http://www.w3.org/2000/svg' fill='context-fill'%3E%3Crect fill='contentFill' y='10' width='15' height='120' rx='6'%3E%3Canimate attributeName='height' begin='0.5s' dur='1s' values='120;110;100;90;80;70;60;50;40;140;120' calcMode='linear' repeatCount='indefinite'/%3E%3Canimate attributeName='y' begin='0.5s' dur='1s' values='10;15;20;25;30;35;40;45;50;0;10' calcMode='linear' repeatCount='indefinite'/%3E%3C/rect%3E%3Crect fill='contentFill' x='30' y='10' width='15' height='120' rx='6'%3E%3Canimate attributeName='height' begin='0.25s' dur='1s' values='120;110;100;90;80;70;60;50;40;140;120' calcMode='linear' repeatCount='indefinite'/%3E%3Canimate attributeName='y' begin='0.25s' dur='1s' values='10;15;20;25;30;35;40;45;50;0;10' calcMode='linear' repeatCount='indefinite'/%3E%3C/rect%3E%3Crect fill='contentFill' x='60' width='15' height='140' rx='6'%3E%3Canimate attributeName='height' begin='0s' dur='1s' values='120;110;100;90;80;70;60;50;40;140;120' calcMode='linear' repeatCount='indefinite'/%3E%3Canimate attributeName='y' begin='0s' dur='1s' values='10;15;20;25;30;35;40;45;50;0;10' calcMode='linear' repeatCount='indefinite'/%3E%3C/rect%3E%3Crect fill='contentFill' x='90' y='10' width='15' height='120' rx='6'%3E%3Canimate attributeName='height' begin='0.25s' dur='1s' values='120;110;100;90;80;70;60;50;40;140;120' calcMode='linear' repeatCount='indefinite'/%3E%3Canimate attributeName='y' begin='0.25s' dur='1s' values='10;15;20;25;30;35;40;45;50;0;10' calcMode='linear' repeatCount='indefinite'/%3E%3C/rect%3E%3Crect fill='contentFill' x='120' y='10' width='15' height='120' rx='6'%3E%3Canimate attributeName='height' begin='0.5s' dur='1s' values='120;110;100;90;80;70;60;50;40;140;120' calcMode='linear' repeatCount='indefinite'/%3E%3Canimate attributeName='y' begin='0.5s' dur='1s' values='10;15;20;25;30;35;40;45;50;0;10' calcMode='linear' repeatCount='indefinite'/%3E%3C/rect%3E%3C/svg%3E");
        --mute-svg: url("data:image/svg+xml,%3Csvg width='14' height='14' fill='context-fill' viewBox='0 0 136 140' xmlns='http://www.w3.org/2000/svg'%3E%3Crect fill='content-fill' x='4' y='70' width='15' height='15' rx='6'/%3E%3Crect fill='content-fill' x='34' y='70' width='15' height='15' rx='6'/%3E%3Crect fill='content-fill' x='64' y='70' width='15' height='15' rx='6'/%3E%3Crect fill='content-fill' x='94' y='70' width='15' height='15' rx='6'/%3E%3Crect x='124' y='70' width='15' height='15' rx='6'/%3E%3C/svg%3E");
        mask-size: 10px 10px !important;
        mask-repeat: no-repeat !important;
        mask-position: center !important;
      }
  
      @media (prefers-color-scheme: light) {
        &:is([soundplaying], [muted], [activemedia-blocked]) {
          filter: invert(1);
        }
      }
  
      &:is([activemedia-blocked]) {
        background: none !important;
        list-style-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' width='50' height='50' fill='context-fill'%3E%3Cpath d='M0 0 C3.04261908 0.3259949 3.9801219 0.97895261 6.125 3.25 C10.80067538 10.10765723 10.75854626 16.90274712 10 25 C8.66711552 29.34664789 6.52293264 33.06274382 3 36 C2.01 36 1.02 36 0 36 C0.42169501 32.62643988 1.39501858 30.21733512 3.0625 27.3125 C5.50413884 22.5633783 5.85977999 18.25050108 5 13 C4.14055749 10.79165669 3.13574067 8.81508888 1.95703125 6.76171875 C0.76616226 4.56954766 0.30807164 2.46457311 0 0 Z ' fill='contentFill' transform='translate(39,7)'/%3E%3Cpath d='M0 0 C-0.42169501 3.37356012 -1.39501858 5.78266488 -3.0625 8.6875 C-5.50449752 13.43731936 -5.85850686 17.7489386 -5 23 C-4.15206056 25.21300786 -3.18125823 27.17494133 -1.97265625 29.2109375 C-0.93389937 31.12158268 -0.44382988 32.87896037 0 35 C-1.32 35 -2.64 35 -4 35 C-10.01293051 28.81021859 -10.43744298 22.76985381 -10.32421875 14.4609375 C-9.75779176 8.41449998 -7.0335703 0 0 0 Z ' fill='contentFill' transform='translate(11,7)'/%3E%3Cpath d='M0 0 C2.125 0.375 2.125 0.375 4 1 C3.566875 1.8353125 3.566875 1.8353125 3.125 2.6875 C2.75375 3.450625 2.3825 4.21375 2 5 C1.608125 5.721875 1.21625 6.44375 0.8125 7.1875 C-0.36227113 11.25401546 0.02392228 14.90354783 1 19 C2.51553153 21.30166675 2.51553153 21.30166675 4 23 C3.67 23.99 3.34 24.98 3 26 C0.25362183 25.62118922 -0.80049058 25.22167713 -2.6875 23.125 C-5.63236254 18.35712732 -5.49017296 13.43415881 -5 8 C-3.66362375 4.598315 -2.56521154 2.56521154 0 0 Z ' fill='contentFill' transform='translate(12,12)'/%3E%3Cpath d='M0 0 C2.77995714 0.27799571 3.79782921 0.77536579 5.6875 2.875 C8.63236254 7.64287268 8.49017296 12.56584119 8 18 C6.66362375 21.401685 5.56521154 23.43478846 3 26 C0.875 25.625 0.875 25.625 -1 25 C-0.71125 24.443125 -0.4225 23.88625 -0.125 23.3125 C0.24625 22.549375 0.6175 21.78625 1 21 C1.5878125 19.9171875 1.5878125 19.9171875 2.1875 18.8125 C3.74737899 13.41291887 2.65919932 8.50297445 0.4375 3.4375 C-0.2740625 2.2309375 -0.2740625 2.2309375 -1 1 C-0.67 0.67 -0.34 0.34 0 0 Z ' fill='contentFill' transform='translate(35,12)'/%3E%3Cpath d='M0 0 C2.9375 0.8125 2.9375 0.8125 4.9375 3.8125 C4.75 6.875 4.75 6.875 3.9375 9.8125 C0.9375 11.8125 0.9375 11.8125 -2.125 11.625 C-5.0625 10.8125 -5.0625 10.8125 -7.0625 7.8125 C-6.875 4.75 -6.875 4.75 -6.0625 1.8125 C-3.0625 -0.1875 -3.0625 -0.1875 0 0 Z ' fill='contentFill' transform='translate(26.0625,19.1875)'/%3E%3Cpath d='M0 0 C1.32 0 2.64 0 4 0 C6.96681758 4.62823543 7.19975858 7.69786373 6.51953125 12.94921875 C6 15 6 15 4 18 C2.68 18 1.36 18 0 18 C0.144375 17.29875 0.28875 16.5975 0.4375 15.875 C0.623125 14.92625 0.80875 13.9775 1 13 C1.226875 11.96875 1.45375 10.9375 1.6875 9.875 C2.33229486 6.80363259 2.33229486 6.80363259 0 4 C0 2.68 0 1.36 0 0 Z ' fill='contentFill' transform='translate(30,16)'/%3E%3Cpath d='M0 0 C1.32 0.33 2.64 0.66 4 1 C3.855625 1.53625 3.71125 2.0725 3.5625 2.625 C2.89773488 5.43178607 2.30555651 8.12776882 2 11 C2.99 12.485 2.99 12.485 4 14 C4 15.32 4 16.64 4 18 C2.68 18 1.36 18 0 18 C-2.96681758 13.37176457 -3.19975858 10.30213627 -2.51953125 5.05078125 C-2 3 -2 3 0 0 Z ' fill='contentFill' transform='translate(16,16)'/%3E%3C/svg%3E%0A") !important;
        fill:var(--toolbarbutton-icon-fill) !important;
        width: 16px !important;
        height: 16px !important;
        margin: 0px 3px !important;
      }
  
      &:is([soundplaying]) {
        list-style-image: var(--play-svg) !important;
        fill: var(--toolbarbutton-icon-fill) !important;
      }
      
      &:is([muted]) {
        list-style-image: var(--mute-svg) !important;
        fill: var(--toolbarbutton-icon-fill) !important;
      }
    }
  

      .tabbrowser-tab:is([soundplaying], [muted], [activemedia-blocked])
        img {
        opacity: 1 !important;
        transition: opacity 0.1s ease-out !important;
      }
  
      .tabbrowser-tab:is([soundplaying], [muted], [activemedia-blocked])
        .tab-icon-overlay {
        margin: 0px !important;
        transition: opacity 0.25s ease-out, transform 0.25s ease-out !important;
        transform: translate(6.9px, -6.9px) scale(0.69) !important;
      }

      .tabbrowser-tab:is([soundplaying], [muted], [activemedia-blocked]) .tab-icon-overlay {
        transition: opacity 0.25s ease-in, transform 0.25s ease-in !important;
      }
    
  
    #zen-essentials-container {
      .tab-icon-overlay:is([soundplaying], [muted], [activemedia-blocked]) {
        margin: 0px !important;
      }
    }   
   

/* Base styles for tab audio indicators */
.tabbrowser-tab[soundplaying] .tab-icon-overlay,
.tabbrowser-tab[muted] .tab-icon-overlay,
.tabbrowser-tab[activemedia-blocked] .tab-icon-overlay,
.tabbrowser-tab[soundplaying] .tab-audio-button,
.tabbrowser-tab[muted] .tab-audio-button,
.tabbrowser-tab[activemedia-blocked] .tab-audio-button {
  background: transparent !important;
  transition: all 0.3s ease !important;
  opacity: 0.7 !important;
}

/* Hover states */
.tabbrowser-tab[soundplaying] .tab-icon-overlay:hover,
.tabbrowser-tab[muted] .tab-icon-overlay:hover,
.tabbrowser-tab[activemedia-blocked] .tab-icon-overlay:hover,
.tabbrowser-tab[soundplaying] .tab-audio-button:hover,
.tabbrowser-tab[muted] .tab-audio-button:hover,
.tabbrowser-tab[activemedia-blocked] .tab-audio-button:hover {
  background: transparent !important;
  scale: 1.1 !important;
  opacity: 1 !important;
}

/* Non-hover states */
.tabbrowser-tab[soundplaying] .tab-icon-overlay:not(:hover),
.tabbrowser-tab[muted] .tab-icon-overlay:not(:hover),
.tabbrowser-tab[activemedia-blocked] .tab-icon-overlay:not(:hover),
.tabbrowser-tab[soundplaying] .tab-audio-button:not(:hover),
.tabbrowser-tab[muted] .tab-audio-button:not(:hover),
.tabbrowser-tab[activemedia-blocked] .tab-audio-button:not(:hover) {
  background: transparent !important;
  scale: 0.85 !important;
  opacity: 0.3 !important;
}

/* === TOOLBAR BUTTON HOVER ANIMATIONS === */
/* Settings button animation */
toolbar toolbarbutton[label="Settings"]:not([open="true"]):not([cui-areatype="menu-panel"]):not(#nav-bar *):hover,
#nav-bar toolbarbutton[label="Settings"]:not([open="true"]):not([cui-areatype="menu-panel"]):hover {
  animation: settingsSpin 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes settingsSpin {
  0% { 
    transform: rotate(0deg) scale(1); 
  }
  25% {
    transform: rotate(90deg) scale(1.15);
  }
  50% { 
    transform: rotate(180deg) scale(1.1); 
  }
  75% {
    transform: rotate(270deg) scale(1.15);
  }
  100% { 
    transform: rotate(360deg) scale(1); 
  }
}

/* History button with clock-like rewind animation */
#history-panelmenu,
#PanelUI-history-button {
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  background: transparent !important;
}

#history-panelmenu:hover,
#PanelUI-history-button:hover {
  animation: historyRewind 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  background: transparent !important;
}

@keyframes historyRewind {
  0%, 100% { 
    transform: rotate(0deg) scale(1); 
  }
  25% {
    transform: rotate(-30deg) scale(1.08);
  }
  50% { 
    transform: rotate(-60deg) scale(1.12); 
  }
  75% {
    transform: rotate(-30deg) scale(1.08);
  }
}

/* Bookmarks button with magnetic pull effect */
#BMB_viewBookmarksSidebar,
#BMB_searchBookmarks,
#BMB_bookmarksShowAllTop,
#BMB_bookmarksShowAll {
  display: none !important;
}

#bookmarks-menu-button #BMB_viewBookmarksToolbar {
  display: none !important;
}

#BMB_bookmarksPopup menuseparator {
  display: none;
}

#bookmarks-menu-button,
#PanelUI-bookmarks-button {
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  background: transparent !important;
}

#bookmarks-menu-button:hover,
#PanelUI-bookmarks-button:hover {
  animation: bookmarkMagnet 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  background: transparent !important;
}

/* Stop animation when panel is open */
#bookmarks-menu-button[open],
#PanelUI-bookmarks-button[open],
#bookmarks-menu-button[open]:hover,
#PanelUI-bookmarks-button[open]:hover {
  animation: none !important;
  transform: none !important;
}

@keyframes bookmarkMagnet {
  0% { 
    transform: scale(1) translateY(0); 
  }
  100% { 
    transform: scale(1.15) translateY(-3px); 
  }
}

/* Search/Find button with ripple pulse effect */
#search-container,
#urlbar-search-button,
#find-button,
toolbarbutton[data-l10n-id="toolbar-button-find"],
#wrapper-find-button {
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  background: transparent !important;
  position: relative;
}

#search-container:hover,
#urlbar-search-button:hover,
#find-button:hover,
toolbarbutton[data-l10n-id="toolbar-button-find"]:hover,
#wrapper-find-button:hover {
  animation: findRipple 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  background: transparent !important;
}

@keyframes findRipple {
  0% { 
    transform: scale(1); 
  }
  15% {
    transform: scale(1.15);
  }
  30% { 
    transform: scale(0.95); 
  }
  45% {
    transform: scale(1.08);
  }
  60% {
    transform: scale(0.98);
  }
  75% {
    transform: scale(1.04);
  }
  100% { 
    transform: scale(1); 
  }
}

/* Downloads button with bounce down animation */
#downloads-button {
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  background: transparent !important;
}

#downloads-button:hover {
  animation: downloadBounce 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  background: transparent !important;
}

@keyframes downloadBounce {
  0%, 100% { 
    transform: translateY(0) scale(1); 
  }
  20% {
    transform: translateY(-6px) scale(1.05);
  }
  40% { 
    transform: translateY(3px) scale(1.15); 
    filter: brightness(1.3) drop-shadow(0 4px 12px rgba(76, 175, 80, 0.6));
  }
  60% {
    transform: translateY(-2px) scale(1.08);
  }
  80% {
    transform: translateY(1px) scale(1.12);
  }
}

/* Active/Click states for all toolbar buttons */
#PanelUI-menu-button:active,
#history-panelmenu:active,
#PanelUI-history-button:active,
#bookmarks-menu-button:active,
#PanelUI-bookmarks-button:active,
#search-container:active,
#urlbar-search-button:active,
#downloads-button:active {
  transform: scale(0.9) !important;
  transition: all 0.1s ease !important;
  animation: none !important;
}

@-moz-document url-prefix("chrome:") {
  /* ------------------- PDF Tab Custom Icon ------------------- */
  
  tab[label$='.pdf'] img.tab-icon-image {
      background: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='none' viewBox='0 0 16 16' xmlns:bx='https://boxy-svg.com'%3E%3Cdefs%3E%3Cbx:export%3E%3Cbx:file format='svg' path='doc icon.svg'/%3E%3C/bx:export%3E%3C/defs%3E%3Cpath fill='%23181c1f' d='M 18.4 0.164 L 34.4 0.164 L 34.4 16.164 L 18.4 16.164 L 18.4 0.164 Z'/%3E%3Cpath fill='%23fff' fill-rule='evenodd' d='M4.75 2.5c-.69 0-1.25.56-1.25 1.25v8.5c0 .69.56 1.25 1.25 1.25h6.5c.69 0 1.25-.56 1.25-1.25V7H9.75A1.75 1.75 0 0 1 8 5.25V2.5zm4.75.81v1.94c0 .138.112.25.25.25h1.94zM2 3.75A2.75 2.75 0 0 1 4.75 1h3.836c.464 0 .909.184 1.237.513l3.664 3.664c.329.328.513.773.513 1.237v5.836A2.75 2.75 0 0 1 11.25 15h-6.5A2.75 2.75 0 0 1 2 12.25z' clip-rule='evenodd'/%3E%3C/svg%3E%0A") !important;
      height: 32px !important;
      scale: 0.5 !important;
      margin-left: -5px !important;
      width: 30px !important;
  }
